#!/usr/bin/env python3
'''
Date : 1402/01/04
Author : AmirhosseinKhanshabani - @AmirZoyber
 Interfacing the Windows API
 we work with the Windows API using ctypes

You can see the documentation of the ctypes module here :
https://docs.python.org/3/library/ctypes.html

And you can read about msdn.microsoft.com here :
https://msdn.microsoft.com/en-us/library/windows/desktop/ms633548(v=vs.85).aspx
'''

import ctypes

# we need to load the kernel32.dll library
kernel32 = ctypes.WinDLL("kernel32.dll")

from ctypes import *
from ctypes.wintypes import HWND, LPCSTR , UINT , INT , LPSTR , LPWORD , DWORD , HANDLE , BOOL

MessageBoxA = windll.user32.MessageBoxA
MessageBoxA.argtypes = (HWND, LPCSTR, LPCSTR, UINT)
MessageBoxA.restype = INT
print(MessageBoxA)  # output : <function MessageBoxA at 0x0000000002B0F048>

lpText = LPCSTR(b"Hello World!")
lpCaption = LPCSTR(b"Hello")
MB_OK = 0x00000000
MessageBoxA(None, lpText, lpCaption, MB_OK)
# it will show a message box with "Hello World!" in it
# and the title of the message box will be "Hello"
# and print a line like this : <_FuncPtr object at 0x000001781E7FD980>

# we can use the MessageBoxA function like this :
MessageBoxA(None, b"Hello World!", b"Hello", MB_OK)


# getusername msdn function
#  msdn.microsoft.com/en-us/library/windows/desktop/ms724432(v=vs.85).aspx

GetUserNameA = windll.advapi32.GetUserNameA
GetUserNameA.argtypes = (LPSTR, LPWORD)
GetUserNameA.restype = INT

bufferSize = DWORD(16)
buffer = ctypes.create_string_buffer(bufferSize.value)

GetUserNameA(buffer, ctypes.byref(bufferSize))
print(buffer.value)  # output : b'AmirZoyber'

# if we dont get enough space for the buffer
# out put will be like this :
# b''


# for getting the last error
# we use the GetLastError function msdn.microsoft.com/en-us/library/windows/desktop/ms679360(v=vs.85).aspx
# search for "GetLastError msdn" in google
error = GetLastError()

if error != 0:
    print(error)  # output : 122
    # 122 is the error code for ERROR_INSUFFICIENT_BUFFER
    # msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx
    # search for "ERROR_INSUFFICIENT_BUFFER msdn" in google
    '''search for msdn error codes in google'''
    print(WinError(error))  # output : [Error 122] The data area passed to a system call is too small.



# msdn getwindowrect
'''search for "GetWindowRect msdn" in google'''

class RECT(Structure):
    _fields_ = [("left", c_long), ("top", c_long), ("right", c_long), ("bottom", c_long)]

rect = RECT()

print(rect.left)  # output : 0
print(rect.top)  # output : 0
print(rect.right)  # output : 0
print(rect.bottom)  # output : 0


GetWindowRect = windll.user32.GetWindowRect
GetWindowRect.argtypes = (HANDLE, POINTER(RECT))
GetWindowRect.restype = BOOL

hwnd = windll.user32.GetForegroundWindow()
GetWindowRect(hwnd, ctypes.byref(rect))

print(rect.left)       # output : -1609
print(rect.top)        #           56
print(rect.right)      #           9
print(rect.bottom)     #           934


